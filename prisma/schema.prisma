generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum SwapStatus {
  PENDING
  ACCEPTED
  REJECTED
}

model User {
  id            Int      @id @default(autoincrement())
  firstName     String
  lastName      String
  email         String   @unique
  password      String
  createdAt     DateTime @default(now())
  avatar        String?  @default("")
  bio           String?  @default("")

  skillsOffered Skill[] @relation("SkillsOffered")
  skillsWanted  Skill[] @relation("SkillsWanted")

  sentRequests     SwapRequest[] @relation("RequestsSent")
  receivedRequests SwapRequest[] @relation("RequestsReceived")
}

model Skill {
  id            Int      @id @default(autoincrement())
  name          String
  userOfferedId Int?
  userWantedId  Int?
  description   String?
  level         String?
  platform      String?
  publicListing Boolean? @default(true)
  sessionLength Int?
  days          String?
  learnGoal     String?
  learnLevel    String?
  learnSkill    String?
  timeFrom      String?
  timeTo        String?

  userOffered   User? @relation("SkillsOffered", fields: [userOfferedId], references: [id])
  userWanted    User? @relation("SkillsWanted", fields: [userWantedId], references: [id])
}

model SwapRequest {
  id          Int        @id @default(autoincrement())

  requester   User       @relation("RequestsSent", fields: [requesterId], references: [id])
  requesterId Int

  receiver    User       @relation("RequestsReceived", fields: [receiverId], references: [id])
  receiverId  Int

  skillName   String
  message     String?

  status      SwapStatus @default(PENDING)
  createdAt   DateTime   @default(now())

  @@index([requesterId, receiverId, skillName])
}
